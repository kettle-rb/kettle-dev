# TypeProf 0.21.11

module Kettle
  module Dev
    # Prism-based AST merging for templated Ruby files.
    # Handles strategy dispatch (skip/replace/append/merge).
    #
    # Uses prism-merge for AST-aware merging with support for:
    # - Freeze blocks (kettle-dev:freeze / kettle-dev:unfreeze)
    # - Comment preservation
    # - Signature-based node matching
    module SourceMerger
      BUG_URL: String

      # Apply a templating strategy to merge source and destination Ruby files
      #
      # @param strategy [Symbol] Merge strategy - :skip, :replace, :append, or :merge
      # @param src [String] Template source content
      # @param dest [String] Destination file content
      # @param path [String] File path (for error messages)
      # @return [String] Merged content with comments preserved
      # @raise [Kettle::Dev::Error] If strategy is unknown or merge fails
      def self.apply: (
        strategy: Symbol,
        src: String,
        dest: String,
        path: String
      ) -> String

      # Normalize strategy symbol
      #
      # @param strategy [Symbol, nil] Strategy to normalize
      # @return [Symbol] Normalized strategy (:skip if nil)
      def self.normalize_strategy: (Symbol? strategy) -> Symbol

      # Warn about bugs and print error information
      #
      # @param path [String] File path that caused the error
      # @param error [StandardError] The error that occurred
      # @return [void]
      def self.warn_bug: (String path, StandardError error) -> void

      # Ensure text ends with newline
      #
      # @param text [String, nil] Text to process
      # @return [String] Text with trailing newline
      def self.ensure_trailing_newline: (String? text) -> String

      # Apply append strategy using prism-merge
      #
      # @param src_content [String] Template source content
      # @param dest_content [String] Destination content
      # @return [String] Merged content with destination preference
      def self.apply_append: (String src_content, String dest_content) -> String

      # Apply merge strategy using prism-merge
      #
      # @param src_content [String] Template source content
      # @param dest_content [String] Destination content
      # @return [String] Merged content with template preference
      def self.apply_merge: (String src_content, String dest_content) -> String

      # Create a signature generator for prism-merge
      # Handles various Ruby node types for proper matching during merge operations
      #
      # @return [Proc] Signature generator lambda
      def self.create_signature_generator: () -> ^(Prism::Node) -> (Array[untyped] | Prism::Node)
    end
  end
end