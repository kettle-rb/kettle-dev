<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Class: Kettle::Dev::ReadmeBackers
  
    &mdash; Documentation by YARD 0.9.37
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "Kettle::Dev::ReadmeBackers";
  relpath = '../../';
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="../../class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="../../_index.html">Index (R)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../Kettle.html" title="Kettle (module)">Kettle</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../Dev.html" title="Kettle::Dev (module)">Dev</a></span></span>
     &raquo; 
    <span class="title">ReadmeBackers</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Class: Kettle::Dev::ReadmeBackers
  
  
  
</h1>
<div class="box_info">
  
  <dl>
    <dt>Inherits:</dt>
    <dd>
      <span class="inheritName">Object</span>
      
        <ul class="fullTree">
          <li>Object</li>
          
            <li class="next">Kettle::Dev::ReadmeBackers</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
    </dd>
  </dl>
  

  
  
  
  
  

  

  
  <dl>
    <dt>Defined in:</dt>
    <dd>lib/kettle/dev/readme_backers.rb</dd>
  </dl>
  
</div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="ReadmeBackers/Backer.html" title="Kettle::Dev::ReadmeBackers::Backer (class)">Backer</a></span>
    
  
</p>

  
    <h2>
      Constant Summary
      <small><a href="#" class="constants_summary_toggle">collapse</a></small>
    </h2>

    <dl class="constants">
      
        <dt id="README_PATH-constant" class="">README_PATH =
          <div class="docstring">
  <div class="discussion">
    <p>Default README is the one in the current working directory of the host project</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_expand_path'>expand_path</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>README.md</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_pwd'>pwd</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="README_OSC_TAG_DEFAULT-constant" class="">README_OSC_TAG_DEFAULT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>OPENCOLLECTIVE</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="COMMIT_SUBJECT_DEFAULT-constant" class="">COMMIT_SUBJECT_DEFAULT =
          
        </dt>
        <dd><pre class="code"><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>üí∏ Thanks üôè to our new backers üéí and subscribers üìú</span><span class='tstring_end'>&quot;</span></span></pre></dd>
      
        <dt id="OC_YML_PATH-constant" class="">OC_YML_PATH =
          <div class="docstring">
  <div class="discussion">
    <p>Deprecated constant maintained for backwards compatibility in tests/specs.<br />
Prefer OpenCollectiveConfig.yaml_path going forward, but resolve to the host project root.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'><span class='object_link'><a href="OpenCollectiveConfig.html" title="Kettle::Dev::OpenCollectiveConfig (module)">OpenCollectiveConfig</a></span></span><span class='period'>.</span><span class='id identifier rubyid_yaml_path'><span class='object_link'><a href="OpenCollectiveConfig.html#yaml_path-class_method" title="Kettle::Dev::OpenCollectiveConfig.yaml_path (method)">yaml_path</a></span></span><span class='lparen'>(</span><span class='const'>Dir</span><span class='period'>.</span><span class='id identifier rubyid_pwd'>pwd</span><span class='rparen'>)</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">#<strong>initialize</strong>(handle: nil, readme_path: README_PATH)  &#x21d2; ReadmeBackers </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>A new instance of ReadmeBackers.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#run!-instance_method" title="#run! (instance method)">#<strong>run!</strong>  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#validate-instance_method" title="#validate (instance method)">#<strong>validate</strong>  &#x21d2; void </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'><p>Validate environment preconditions for running the updater.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    #<strong>initialize</strong>(handle: nil, readme_path: README_PATH)  &#x21d2; <tt><span class='object_link'><a href="" title="Kettle::Dev::ReadmeBackers (class)">ReadmeBackers</a></span></tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p>Returns a new instance of ReadmeBackers.</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


62
63
64
65</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kettle/dev/readme_backers.rb', line 62</span>

<span class='kw'>def</span> <span class='id identifier rubyid_initialize'>initialize</span><span class='lparen'>(</span><span class='label'>handle:</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='label'>readme_path:</span> <span class='const'><span class='object_link'><a href="#README_PATH-constant" title="Kettle::Dev::ReadmeBackers::README_PATH (constant)">README_PATH</a></span></span><span class='rparen'>)</span>
  <span class='ivar'>@handle</span> <span class='op'>=</span> <span class='id identifier rubyid_handle'>handle</span> <span class='op'>||</span> <span class='id identifier rubyid_resolve_handle'>resolve_handle</span>
  <span class='ivar'>@readme_path</span> <span class='op'>=</span> <span class='id identifier rubyid_readme_path'>readme_path</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="run!-instance_method">
  
    #<strong>run!</strong>  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kettle/dev/readme_backers.rb', line 91</span>

<span class='kw'>def</span> <span class='id identifier rubyid_run!'>run!</span>
  <span class='id identifier rubyid_validate'>validate</span>
  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Starting run: handle=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@handle</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, readme=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@readme_path</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Resolved OSC tag base=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_readme_osc_tag'>readme_osc_tag</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_readme'>readme</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_read'>read</span><span class='lparen'>(</span><span class='ivar'>@readme_path</span><span class='rparen'>)</span>

  <span class='comment'># Identify previous entries for diffing/mentions
</span>  <span class='id identifier rubyid_b_start'>b_start</span><span class='comma'>,</span> <span class='id identifier rubyid_b_end'>b_end</span> <span class='op'>=</span> <span class='id identifier rubyid_detect_backer_tags'>detect_backer_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_readme'>readme</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_s_start_prev'>s_start_prev</span><span class='comma'>,</span> <span class='id identifier rubyid_s_end_prev'>s_end_prev</span> <span class='op'>=</span> <span class='id identifier rubyid_detect_sponsor_tags'>detect_sponsor_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_readme'>readme</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backer tags present=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_b_start'>b_start</span> <span class='op'>!=</span> <span class='symbol'>:not_found</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_b_end'>b_end</span> <span class='op'>!=</span> <span class='symbol'>:not_found</span><span class='embexpr_end'>}</span><span class='tstring_content'>; Sponsor tags present=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_s_start_prev'>s_start_prev</span> <span class='op'>!=</span> <span class='symbol'>:not_found</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_s_end_prev'>s_end_prev</span> <span class='op'>!=</span> <span class='symbol'>:not_found</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prev_backer_identities'>prev_backer_identities</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_section_identities'>extract_section_identities</span><span class='lparen'>(</span><span class='id identifier rubyid_readme'>readme</span><span class='comma'>,</span> <span class='id identifier rubyid_b_start'>b_start</span><span class='comma'>,</span> <span class='id identifier rubyid_b_end'>b_end</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_prev_sponsor_identities'>prev_sponsor_identities</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_section_identities'>extract_section_identities</span><span class='lparen'>(</span><span class='id identifier rubyid_readme'>readme</span><span class='comma'>,</span> <span class='id identifier rubyid_s_start_prev'>s_start_prev</span><span class='comma'>,</span> <span class='id identifier rubyid_s_end_prev'>s_end_prev</span><span class='rparen'>)</span>

  <span class='comment'># Fetch all BACKER-role members once and partition by tier
</span>  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fetching OpenCollective members JSON for handle=</span><span class='embexpr_beg'>#{</span><span class='ivar'>@handle</span><span class='embexpr_end'>}</span><span class='tstring_content'> ...</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_raw'>raw</span> <span class='op'>=</span> <span class='id identifier rubyid_fetch_all_backers_raw'>fetch_all_backers_raw</span>
  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Fetched </span><span class='embexpr_beg'>#{</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> members (role=</span><span class='embexpr_beg'>#{</span><span class='const'><span class='object_link'><a href="ReadmeBackers/Backer.html" title="Kettle::Dev::ReadmeBackers::Backer (class)">Backer</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="ReadmeBackers/Backer.html#ROLE-constant" title="Kettle::Dev::ReadmeBackers::Backer::ROLE (constant)">ROLE</a></span></span><span class='embexpr_end'>}</span><span class='tstring_content'>) before tier partitioning</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='comment'># Build OpenCollective type-index map to generate stable avatar/website links
</span>  <span class='id identifier rubyid_index_map'>index_map</span> <span class='op'>=</span> <span class='id identifier rubyid_build_oc_index_map'>build_oc_index_map</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Kettle.html" title="Kettle (module)">Kettle</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Dev.html" title="Kettle::Dev (module)">Dev</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Dev.html#DEBUGGING-constant" title="Kettle::Dev::DEBUGGING (constant)">DEBUGGING</a></span></span>
    <span class='id identifier rubyid_tier_counts'>tier_counts</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='lparen'>(</span><span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_transform_values'>transform_values</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:size</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Tier distribution: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_tier_counts'>tier_counts</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_empty_tier'>empty_tier</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='rbrace'>}</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_empty_tier'>empty_tier</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Members with empty tier: count=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_empty_tier'>empty_tier</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>; showing up to 5 samples:</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_empty_tier'>empty_tier</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='lparen'>(</span><span class='int'>5</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_each_with_index'>each_with_index</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_m'>m</span><span class='comma'>,</span> <span class='id identifier rubyid_i'>i</span><span class='op'>|</span>
        <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  [empty-tier #</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_i'>i</span> <span class='op'>+</span> <span class='int'>1</span><span class='embexpr_end'>}</span><span class='tstring_content'>] name=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>name</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, isActive=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>isActive</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, profile=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>profile</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_content'>, website=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_m'>m</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>website</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='kw'>end</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_other_tiers'>other_tiers</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_map'>map</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_reject'>reject</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>||</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_casecmp'>casecmp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>||</span> <span class='id identifier rubyid_t'>t</span><span class='period'>.</span><span class='id identifier rubyid_casecmp'>casecmp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='rbrace'>}</span>
    <span class='kw'>unless</span> <span class='id identifier rubyid_other_tiers'>other_tiers</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='id identifier rubyid_counts'>counts</span> <span class='op'>=</span> <span class='id identifier rubyid_other_tiers'>other_tiers</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_t'>t</span><span class='op'>|</span> <span class='id identifier rubyid_t'>t</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_transform_values'>transform_values</span><span class='lparen'>(</span><span class='op'>&amp;</span><span class='symbol'>:size</span><span class='rparen'>)</span>
      <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Non-standard tiers present (excluding Backer/Sponsor): </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_counts'>counts</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_backers_hashes'>backers_hashes</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_casecmp'>casecmp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='rbrace'>}</span>
  <span class='id identifier rubyid_sponsors_hashes'>sponsors_hashes</span> <span class='op'>=</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_casecmp'>casecmp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='rbrace'>}</span>

  <span class='id identifier rubyid_backers'>backers</span> <span class='op'>=</span> <span class='id identifier rubyid_map_hashes_to_backers'>map_hashes_to_backers</span><span class='lparen'>(</span><span class='id identifier rubyid_backers_hashes'>backers_hashes</span><span class='comma'>,</span> <span class='id identifier rubyid_index_map'>index_map</span><span class='comma'>,</span> <span class='label'>force_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>backer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sponsors'>sponsors</span> <span class='op'>=</span> <span class='id identifier rubyid_map_hashes_to_backers'>map_hashes_to_backers</span><span class='lparen'>(</span><span class='id identifier rubyid_sponsors_hashes'>sponsors_hashes</span><span class='comma'>,</span> <span class='id identifier rubyid_index_map'>index_map</span><span class='comma'>,</span> <span class='label'>force_type:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>organization</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Partitioned counts =&gt; Backers=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_backers'>backers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>, Sponsors=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sponsors'>sponsors</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>if</span> <span class='const'><span class='object_link'><a href="../../Kettle.html" title="Kettle (module)">Kettle</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Dev.html" title="Kettle::Dev (module)">Dev</a></span></span><span class='op'>::</span><span class='const'><span class='object_link'><a href="../Dev.html#DEBUGGING-constant" title="Kettle::Dev::DEBUGGING (constant)">DEBUGGING</a></span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_backers'>backers</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_sponsors'>sponsors</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_any?'>any?</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No Backer or Sponsor tiers matched among </span><span class='embexpr_beg'>#{</span><span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'> BACKER-role records. If tiers are empty, they will not appear in Backers/Sponsors sections.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Additional dynamic tiers (exclude Backer/Sponsor)
</span>  <span class='id identifier rubyid_extra_map'>extra_map</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
  <span class='const'>Array</span><span class='lparen'>(</span><span class='id identifier rubyid_raw'>raw</span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_group_by'>group_by</span> <span class='lbrace'>{</span> <span class='op'>|</span><span class='id identifier rubyid_h'>h</span><span class='op'>|</span> <span class='id identifier rubyid_h'>h</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tier</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span> <span class='rbrace'>}</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_tier'>tier</span><span class='comma'>,</span> <span class='id identifier rubyid_members'>members</span><span class='op'>|</span>
    <span class='id identifier rubyid_normalized'>normalized</span> <span class='op'>=</span> <span class='id identifier rubyid_tier'>tier</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>?</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Donors</span><span class='tstring_end'>&quot;</span></span> <span class='op'>:</span> <span class='id identifier rubyid_tier'>tier</span>
    <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_normalized'>normalized</span><span class='period'>.</span><span class='id identifier rubyid_casecmp'>casecmp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span> <span class='op'>||</span> <span class='id identifier rubyid_normalized'>normalized</span><span class='period'>.</span><span class='id identifier rubyid_casecmp'>casecmp</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_zero?'>zero?</span>
    <span class='id identifier rubyid_extra_map'>extra_map</span><span class='lbracket'>[</span><span class='id identifier rubyid_normalized'>normalized</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_map_hashes_to_backers'>map_hashes_to_backers</span><span class='lparen'>(</span><span class='id identifier rubyid_members'>members</span><span class='comma'>,</span> <span class='id identifier rubyid_index_map'>index_map</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Extra tiers detected: </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_extra_map'>extra_map</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_sort'>sort</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_extra_map'>extra_map</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>

  <span class='id identifier rubyid_backers_md'>backers_md</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_markdown'>generate_markdown</span><span class='lparen'>(</span><span class='id identifier rubyid_backers'>backers</span><span class='comma'>,</span> <span class='label'>empty_message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No backers yet. Be the first!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>default_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backer</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sponsors_md_base'>sponsors_md_base</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_markdown'>generate_markdown</span><span class='lparen'>(</span><span class='id identifier rubyid_sponsors'>sponsors</span><span class='comma'>,</span> <span class='label'>empty_message:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No sponsors yet. Be the first!</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='label'>default_name:</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsor</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>

  <span class='id identifier rubyid_extra_tiers_md'>extra_tiers_md</span> <span class='op'>=</span> <span class='id identifier rubyid_generate_extra_tiers_markdown'>generate_extra_tiers_markdown</span><span class='lparen'>(</span><span class='id identifier rubyid_extra_map'>extra_map</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_sponsors_md'>sponsors_md</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_extra_tiers_md'>extra_tiers_md</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_sponsors_md_base'>sponsors_md_base</span>
  <span class='kw'>else</span>
    <span class='lbracket'>[</span><span class='id identifier rubyid_sponsors_md_base'>sponsors_md_base</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_extra_tiers_md'>extra_tiers_md</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Update backers section
</span>  <span class='comment'># If the identities in the existing block match the identities derived from current data,
</span>  <span class='comment'># treat as no-change to avoid rewriting formatting (e.g., Markdown -&gt; HTML OC anchors).
</span>  <span class='id identifier rubyid_semantically_same_backers'>semantically_same_backers</span> <span class='op'>=</span> <span class='id identifier rubyid_semantically_same_section?'>semantically_same_section?</span><span class='lparen'>(</span><span class='id identifier rubyid_prev_backer_identities'>prev_backer_identities</span><span class='comma'>,</span> <span class='id identifier rubyid_backers'>backers</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_updated'>updated</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_semantically_same_backers'>semantically_same_backers</span>
    <span class='symbol'>:no_change</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_replace_between_tags'>replace_between_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_readme'>readme</span><span class='comma'>,</span> <span class='id identifier rubyid_b_start'>b_start</span><span class='comma'>,</span> <span class='id identifier rubyid_b_end'>b_end</span><span class='comma'>,</span> <span class='id identifier rubyid_backers_md'>backers_md</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_updated'>updated</span>
  <span class='kw'>when</span> <span class='symbol'>:not_found</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backers tag block not found; skipping backers section update</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_updated_readme'>updated_readme</span> <span class='op'>=</span> <span class='id identifier rubyid_readme'>readme</span>
    <span class='id identifier rubyid_backers_changed'>backers_changed</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_new_backers'>new_backers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='symbol'>:no_change</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backers section unchanged (identities match or generated markdown matches existing block)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_updated_readme'>updated_readme</span> <span class='op'>=</span> <span class='id identifier rubyid_readme'>readme</span>
    <span class='id identifier rubyid_backers_changed'>backers_changed</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_new_backers'>new_backers</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_updated_readme'>updated_readme</span> <span class='op'>=</span> <span class='id identifier rubyid_updated'>updated</span>
    <span class='id identifier rubyid_backers_changed'>backers_changed</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_new_backers'>new_backers</span> <span class='op'>=</span> <span class='id identifier rubyid_compute_new_members'>compute_new_members</span><span class='lparen'>(</span><span class='id identifier rubyid_prev_backer_identities'>prev_backer_identities</span><span class='comma'>,</span> <span class='id identifier rubyid_backers'>backers</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Backers section updated; new_backers=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_backers'>new_backers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='comment'># Update sponsors section (with extra tiers appended when present)
</span>  <span class='id identifier rubyid_s_start'>s_start</span><span class='comma'>,</span> <span class='id identifier rubyid_s_end'>s_end</span> <span class='op'>=</span> <span class='id identifier rubyid_detect_sponsor_tags'>detect_sponsor_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_updated_readme'>updated_readme</span><span class='rparen'>)</span>
  <span class='comment'># If there is no sponsors section but there is a backers section, append extra tiers to backers instead.
</span>  <span class='kw'>if</span> <span class='id identifier rubyid_s_start'>s_start</span> <span class='op'>==</span> <span class='symbol'>:not_found</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_extra_tiers_md'>extra_tiers_md</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_b_start'>b_start</span> <span class='op'>!=</span> <span class='symbol'>:not_found</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsors tags not found; appending extra tiers under Backers section</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_backers_md_with_extra'>backers_md_with_extra</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='id identifier rubyid_backers_md'>backers_md</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='id identifier rubyid_extra_tiers_md'>extra_tiers_md</span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_updated'>updated</span> <span class='op'>=</span> <span class='id identifier rubyid_replace_between_tags'>replace_between_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_updated_readme'>updated_readme</span><span class='comma'>,</span> <span class='id identifier rubyid_b_start'>b_start</span><span class='comma'>,</span> <span class='id identifier rubyid_b_end'>b_end</span><span class='comma'>,</span> <span class='id identifier rubyid_backers_md_with_extra'>backers_md_with_extra</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_updated_readme'>updated_readme</span> <span class='op'>=</span> <span class='id identifier rubyid_updated'>updated</span> <span class='kw'>unless</span> <span class='id identifier rubyid_updated'>updated</span> <span class='op'>==</span> <span class='symbol'>:no_change</span> <span class='op'>||</span> <span class='id identifier rubyid_updated'>updated</span> <span class='op'>==</span> <span class='symbol'>:not_found</span>
  <span class='kw'>end</span>

  <span class='comment'># Sponsors: apply the same semantic no-change rule
</span>  <span class='id identifier rubyid_prev_s_ids'>prev_s_ids</span> <span class='op'>=</span> <span class='id identifier rubyid_extract_section_identities'>extract_section_identities</span><span class='lparen'>(</span><span class='id identifier rubyid_updated_readme'>updated_readme</span><span class='comma'>,</span> <span class='id identifier rubyid_s_start'>s_start</span><span class='comma'>,</span> <span class='id identifier rubyid_s_end'>s_end</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_semantically_same_sponsors'>semantically_same_sponsors</span> <span class='op'>=</span> <span class='id identifier rubyid_semantically_same_section?'>semantically_same_section?</span><span class='lparen'>(</span><span class='id identifier rubyid_prev_s_ids'>prev_s_ids</span><span class='comma'>,</span> <span class='id identifier rubyid_sponsors'>sponsors</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_updated2'>updated2</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_semantically_same_sponsors'>semantically_same_sponsors</span>
    <span class='symbol'>:no_change</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_replace_between_tags'>replace_between_tags</span><span class='lparen'>(</span><span class='id identifier rubyid_updated_readme'>updated_readme</span><span class='comma'>,</span> <span class='id identifier rubyid_s_start'>s_start</span><span class='comma'>,</span> <span class='id identifier rubyid_s_end'>s_end</span><span class='comma'>,</span> <span class='id identifier rubyid_sponsors_md'>sponsors_md</span><span class='rparen'>)</span>
  <span class='kw'>end</span>
  <span class='kw'>case</span> <span class='id identifier rubyid_updated2'>updated2</span>
  <span class='kw'>when</span> <span class='symbol'>:not_found</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsors tag block not found; skipping sponsors section update</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sponsors_changed'>sponsors_changed</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_final'>final</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_readme'>updated_readme</span>
    <span class='id identifier rubyid_new_sponsors'>new_sponsors</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>when</span> <span class='symbol'>:no_change</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsors section unchanged (identities match or generated markdown matches existing block)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_sponsors_changed'>sponsors_changed</span> <span class='op'>=</span> <span class='kw'>false</span>
    <span class='id identifier rubyid_final'>final</span> <span class='op'>=</span> <span class='id identifier rubyid_updated_readme'>updated_readme</span>
    <span class='id identifier rubyid_new_sponsors'>new_sponsors</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='kw'>else</span>
    <span class='id identifier rubyid_sponsors_changed'>sponsors_changed</span> <span class='op'>=</span> <span class='kw'>true</span>
    <span class='id identifier rubyid_final'>final</span> <span class='op'>=</span> <span class='id identifier rubyid_updated2'>updated2</span>
    <span class='id identifier rubyid_new_sponsors'>new_sponsors</span> <span class='op'>=</span> <span class='id identifier rubyid_compute_new_members'>compute_new_members</span><span class='lparen'>(</span><span class='id identifier rubyid_prev_sponsor_identities'>prev_sponsor_identities</span><span class='comma'>,</span> <span class='id identifier rubyid_sponsors'>sponsors</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Sponsors section updated; new_sponsors=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_new_sponsors'>new_sponsors</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
  <span class='kw'>end</span>

  <span class='kw'>if</span> <span class='op'>!</span><span class='id identifier rubyid_backers_changed'>backers_changed</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_sponsors_changed'>sponsors_changed</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_b_start'>b_start</span> <span class='op'>==</span> <span class='symbol'>:not_found</span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_s_start'>s_start</span> <span class='op'>==</span> <span class='symbol'>:not_found</span>
      <span class='id identifier rubyid_ts'>ts</span> <span class='op'>=</span> <span class='id identifier rubyid_tag_strings'>tag_strings</span>
      <span class='id identifier rubyid_warn'>warn</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No recognized Open Collective tags found in </span><span class='embexpr_beg'>#{</span><span class='ivar'>@readme_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>. Expected one or more of: </span><span class='tstring_end'>&quot;</span></span> \
        <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='symbol'>:generic_start</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='symbol'>:generic_end</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='symbol'>:individuals_start</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='symbol'>:individuals_end</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>, </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='symbol'>:orgs_start</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='lbracket'>[</span><span class='symbol'>:orgs_end</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Missing tags: looked for </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_ts'>ts</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
      <span class='comment'># Do not exit the process during tests or library use; just return.
</span>      <span class='kw'>return</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_debug_log'>debug_log</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No changes detected after processing; Backers=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_backers'>backers</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>, Sponsors=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_sponsors'>sponsors</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_content'>, ExtraTiers=</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_extra_map'>extra_map</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>No changes to backers or sponsors sections in </span><span class='embexpr_beg'>#{</span><span class='ivar'>@readme_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>return</span>
  <span class='kw'>end</span>

  <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='ivar'>@readme_path</span><span class='comma'>,</span> <span class='id identifier rubyid_final'>final</span><span class='rparen'>)</span>
  <span class='id identifier rubyid_msgs'>msgs</span> <span class='op'>=</span> <span class='lbracket'>[</span><span class='rbracket'>]</span>
  <span class='id identifier rubyid_msgs'>msgs</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>backers</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_backers_changed'>backers_changed</span>
  <span class='id identifier rubyid_msgs'>msgs</span> <span class='op'>&lt;&lt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>sponsors</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_sponsors_changed'>sponsors_changed</span>
  <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Updated </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_msgs'>msgs</span><span class='period'>.</span><span class='id identifier rubyid_join'>join</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'> and </span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='embexpr_end'>}</span><span class='tstring_content'> section</span><span class='embexpr_beg'>#{</span><span class='lbrace'>{</span><span class='kw'>true</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>s</span><span class='tstring_end'>&quot;</span></span><span class='comma'>,</span> <span class='kw'>false</span> <span class='op'>=&gt;</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span><span class='rbrace'>}</span><span class='lbracket'>[</span><span class='id identifier rubyid_msgs'>msgs</span><span class='period'>.</span><span class='id identifier rubyid_size'>size</span> <span class='op'>&gt;</span> <span class='int'>1</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> in </span><span class='embexpr_beg'>#{</span><span class='ivar'>@readme_path</span><span class='embexpr_end'>}</span><span class='tstring_content'>.</span><span class='tstring_end'>&quot;</span></span>

  <span class='comment'># Compose and perform commit with mentions if in a git repo
</span>  <span class='id identifier rubyid_perform_git_commit'>perform_git_commit</span><span class='lparen'>(</span><span class='id identifier rubyid_new_backers'>new_backers</span><span class='comma'>,</span> <span class='id identifier rubyid_new_sponsors'>new_sponsors</span><span class='rparen'>)</span> <span class='kw'>if</span> <span class='id identifier rubyid_git_repo?'>git_repo?</span> <span class='op'>&amp;&amp;</span> <span class='lparen'>(</span><span class='id identifier rubyid_backers_changed'>backers_changed</span> <span class='op'>||</span> <span class='id identifier rubyid_sponsors_changed'>sponsors_changed</span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="validate-instance_method">
  
    #<strong>validate</strong>  &#x21d2; <tt>void</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    <p class="note returns_void">This method returns an undefined value.</p><p>Validate environment preconditions for running the updater.<br />
Ensures README_UPDATER_TOKEN is present. If missing, prints guidance and raises.</p>


  </div>
</div>
<div class="tags">
  
<p class="tag_title">Raises:</p>
<ul class="raise">
  
    <li>
      
      
        <span class='type'>(<tt>RuntimeError</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'><p>when README_UPDATER_TOKEN is not provided</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'lib/kettle/dev/readme_backers.rb', line 72</span>

<span class='kw'>def</span> <span class='id identifier rubyid_validate'>validate</span>
  <span class='id identifier rubyid_token'>token</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>README_UPDATER_TOKEN</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span><span class='period'>.</span><span class='id identifier rubyid_to_s'>to_s</span>
  <span class='kw'>if</span> <span class='id identifier rubyid_token'>token</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='id identifier rubyid_repo'>repo</span> <span class='op'>=</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>REPO</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span> <span class='op'>||</span> <span class='const'>ENV</span><span class='lbracket'>[</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>GITHUB_REPOSITORY</span><span class='tstring_end'>&quot;</span></span><span class='rbracket'>]</span>
    <span class='id identifier rubyid_org'>org</span> <span class='op'>=</span> <span class='id identifier rubyid_repo'>repo</span><span class='op'>&amp;.</span><span class='id identifier rubyid_to_s'>to_s</span><span class='op'>&amp;.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>/</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='op'>&amp;.</span><span class='id identifier rubyid_first'>first</span>
    <span class='id identifier rubyid_org_url'>org_url</span> <span class='op'>=</span> <span class='kw'>if</span> <span class='id identifier rubyid_org'>org</span> <span class='op'>&amp;&amp;</span> <span class='op'>!</span><span class='id identifier rubyid_org'>org</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://github.com/organizations/</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_org'>org</span><span class='embexpr_end'>}</span><span class='tstring_content'>/settings/secrets/actions</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>else</span>
      <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>https://github.com/organizations/YOUR_ORG/settings/secrets/actions</span><span class='tstring_end'>&quot;</span></span>
    <span class='kw'>end</span>
    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: README_UPDATER_TOKEN is not set.</span><span class='tstring_end'>&quot;</span></span>
    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Please create an organization-level Actions secret named README_UPDATER_TOKEN at:</span><span class='tstring_end'>&quot;</span></span>
    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>  </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_org_url'>org_url</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Then update the workflow to reference it, or provide README_UPDATER_TOKEN in the environment.</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_raise'>raise</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>Missing ENV[&quot;README_UPDATER_TOKEN&quot;]</span><span class='tstring_end'>&#39;</span></span>
  <span class='kw'>end</span>
  <span class='kw'>nil</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Oct 29 15:30:49 2025 by
  <a href="https://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.37 (ruby-3.4.7).
</div>

    </div>
  </body>
</html>